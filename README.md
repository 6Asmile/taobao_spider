---

# 淘宝商品信息与评论爬虫 GUI

这是一个带有图形用户界面（GUI）的桌面应用程序，用于爬取淘宝的商品信息和评论。用户可以通过关键词搜索商品列表，或通过商品 URL/ID 提取指定商品的所有评论。爬取到的数据可以方便地导出为 CSV 文件。

本应用使用 Python 和 PyQt5 构建。

## 功能特性

*   **图形化界面**：无需编程知识，操作直观，简单易用。
*   **双重模式**：
    1.  **商品信息模式**：根据关键词搜索淘宝商品。
    2.  **评论模式**：根据商品详情页 URL 或 ID 爬取所有评论。
*   **输入灵活**：支持搜索关键词、商品详情页 URL 或商品 ID (`auctionNumId`)。
*   **动态字段检测**：能自动从淘宝 API 的返回数据中检测所有可用的数据字段。
*   **自定义导出**：允许用户自由勾选、拖拽排序所需字段，按需导出。
*   **分页控制**：用户可以指定开始和结束页码，爬取特定范围的数据。
*   **后台执行**：数据爬取在独立的子线程中进行，避免了界面卡顿，保持了应用的响应性。
*   **实时日志**：在界面上实时显示爬取进度、状态和任何可能出现的错误信息。
*   **CSV 导出**：将抓取的数据保存为 UTF-8 编码的 CSV 文件，方便用 Excel 或其他数据分析工具打开。

## 软件截图

<img width="902" height="739" alt="image" src="https://github.com/user-attachments/assets/4300bba1-29aa-4519-a9df-0af3a4d68953" />



## 环境要求

你需要 Python 3 环境以及以下两个库：

*   `PyQt5`
*   `httpx`

可以使用 pip 命令一键安装：
```bash
pip install PyQt5 httpx
```

## 使用方法

1.  **运行程序**:
    ```bash
    python taobao_gui.py
    ```

2.  **选择模式**: 在左上角的下拉菜单中选择 "商品信息" 或 "评论"。

3.  **输入内容**:
    *   在 **商品信息** 模式下，输入搜索关键词（例如：“笔记本电脑”）。
    *   在 **评论** 模式下，输入完整的商品详情页 URL 或纯数字的商品 ID (`auctionNumId`)。

4.  **填入 Cookie**:
    *   在浏览器中登录你的淘宝账号。
    *   按 F12 打开开发者工具，切换到 `网络` (Network) 标签页。
    *   刷新一下淘宝页面，在网络请求列表中找到任意一个发往 `taobao.com` 或 `tmall.com` 的请求。
    *   在请求头 (Request Headers) 中找到 `Cookie` 项，复制其完整的字符串值，并粘贴到本应用的 "Cookie" 输入框中。
    *   **关键**: Cookie 字符串中必须包含 `_m_h5_tk` 字段，否则 API 请求会失败。

5.  **检测字段与总页数**:
    *   点击 **"检测字段 / 获取总页数"** 按钮。
    *   程序会自动发送一个测试请求，然后将所有返回的可用字段填充到下方的字段列表中，并自动设置“结束页”的最大值。

6.  **选择并排序导出字段**:
    *   在字段列表中，勾选你希望导出到 CSV 文件中的列。
    *   可以使用 "全选" 和 "反选" 按钮进行快捷操作。
    *   你可以**用鼠标拖拽**列表中的字段来进行排序。最终导出的 CSV 文件列顺序将与你在列表中排列的顺序一致。

7.  **设置爬取页码范围**:
    *   在 "起始页" 和 "结束页" 微调框中设置你想要爬取的页面范围。

8.  **选择保存路径**:
    *   点击 **"选择保存路径"** 按钮，在弹出的对话框中选择文件保存的位置和文件名。

9.  **开始爬取**:
    *   点击 **"开始爬取并导出 CSV"** 按钮。
    *   爬取过程的进度和状态会实时显示在下方的 "日志" 文本框中。

10. **完成**: 任务结束后，日志区会提示“导出成功”，你就可以在指定的路径找到生成的 CSV 文件了。如果中途出错，错误信息也会在日志中显示。

## 代码结构说明

该脚本主要由以下几个部分组成：

*   **工具函数 (`工具函数`)**: 包含一系列辅助函数，如移除 HTML 标签、解析 Cookie 字符串、解析用户输入 (URL/ID/关键词)、生成淘宝 API 签名 (`sign_request`) 以及鲁棒的 JSONP 解析。
*   **API 接口 (`商品接口`, `评论接口`)**:
    *   `get_goods_data`: 负责构建并发送商品搜索请求。
    *   `get_comment_data`: 负责构建并发送商品评论请求。
*   **辅助提取函数 (`辅助提取函数`)**: 用于从结构可能多变的 API JSON 响应中稳定地提取出目标数据列表（如评论列表）和总页数信息。
*   **工作线程 (`Worker` Thread)**: `Worker` 类继承自 `QThread`，负责执行所有耗时的网络请求和文件写入操作。这可以防止在爬取过程中图形界面冻结，并通过 PyQt 的信号 (`pyqtSignal`) 机制与主窗口通信。
*   **主窗口 (`MainWindow`)**: GUI 的主类，负责定义界面上的所有控件（按钮、输入框等）、处理用户的交互事件（如按钮点击）以及启动工作线程。

## 免责声明

*   本脚本仅用于学习和技术研究目的。
*   爬取网站数据可能违反其服务条款。请在合理、合法的前提下使用本工具，使用者需自行承担风险。
*   淘宝的 API 随时可能发生变化，这可能导致此脚本失效。
